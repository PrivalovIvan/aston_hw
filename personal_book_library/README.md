# Personal Book Library

Веб-приложение для управления личной библиотекой книг и просмотра общего каталога.

## Описание

Этот проект представляет собой веб-сервис, позволяющий пользователям регистрироваться, входить в систему, просматривать каталог доступных книг, добавлять книги в свою личную коллекцию и управлять ею.

## Возможности

* **Аутентификация пользователей:** Регистрация, вход и управление сессиями.
* **Управление профилем:** Просмотр, обновление и удаление информации пользователя.
* **Каталог книг:**
    * Просмотр всех книг в каталоге.
    * Поиск книг по ID, названию, автору, жанру, году публикации, ключевому слову в названии.
* **Личная библиотека:**
    * Добавление книг из каталога в личную библиотеку пользователя.
    * Удаление книг из личной библиотеки.
    * Просмотр книг в личной библиотеке.
* **Роли пользователей:** Базовая реализация ролей (USER, ADMIN) с использованием фильтра аутентификации.

## Технологии

* **Язык:** Java 17
* **Сборка:** Gradle
* **Веб-технологии:** Jakarta Servlets, JAX-RS (Jersey)
* **База данных:** PostgreSQL
* **Миграции БД:** Liquibase
* **Контейнеризация:** Docker, Docker Compose
* **Зависимости:**
    * Jackson - Обработка JSON
    * Lombok - Сокращение шаблонного кода
    * MapStruct - Маппинг DTO и моделей
    * Hibernate Validator - Валидация входных данных
    * jBCrypt - Хеширование паролей
    * SLF4j & Logback - Логирование
* **Тестирование:** JUnit 5, Mockito

## Установка и запуск

### Предварительные требования

* JDK 17
* Docker
* Docker Compose

### Шаги установки

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_вашего_репозитория>
    cd personal_book_library
    ```

2.  **Настройка базы данных:**
    * Запустите контейнер PostgreSQL с помощью Docker Compose:
        ```bash
        docker-compose up -d
        ```
      Это создаст базу данных `personal_book_library_db` с пользователем `ivan` и паролем `secret` на порту `5433` вашего хоста.
    * Примените миграции базы данных с помощью Liquibase через Gradle:
        ```bash
        ./gradlew update
        ```
      Это создаст необходимые таблицы и заполнит их начальными данными (авторы, жанры, книги).

3.  **Сборка проекта:**
    * Соберите WAR-файл приложения:
        ```bash
        ./gradlew war
        ```
    * Найдите собранный файл в директории `build/libs/`.

4.  **Запуск приложения:**
    * Разверните созданный WAR-файл (`personal_book_library-1.0-SNAPSHOT.war` или похожее имя) в вашем сервлет-контейнере (например, Apache Tomcat, Jetty).
    * Настройте подключение к базе данных в контейнере, если это необходимо, или убедитесь, что приложение может подключиться к БД, запущенной через Docker Compose (настройки находятся в `src/main/resources/application.properties`).

### Конфигурация

* **База данных:** Параметры подключения к БД настраиваются в файле `src/main/resources/application.properties`.
* **Docker:** Конфигурация сервиса PostgreSQL находится в файле `docker-compose.yaml`. 
* **Миграции:** Скрипты миграций Liquibase расположены в `src/main/resources/db/migration/`.

## API Endpoints (Основные)

* **Пользователи (`/profile`)**
    * `POST /register` - Регистрация нового пользователя (тело запроса: UserDTO).
    * `POST /login` - Вход пользователя (параметры: `email`, `password`). Создает сессию.
    * `GET /show` - Показать информацию о текущем залогиненном пользователе (требуется сессия).
    * `PUT /update` - Обновить имя пользователя (параметр: `username`, требуется сессия).
    * `DELETE /delete` - Удалить профиль текущего пользователя (требуется сессия).
* **Каталог книг (`/book-catalog`)**
    * `GET /list/all` - Получить список всех книг.
    * `GET /list/author?author_id={uuid}` - Получить книги по ID автора.
    * `GET /list/genre?genre={name}` - Получить книги по названию жанра.
    * `GET /list/year?start_year={year}&end_year={year}` - Получить книги по диапазону лет.
    * `GET /list/title-containing?keyword={word}` - Получить книги, название которых содержит ключевое слово.
    * `GET /item/id?id={uuid}` - Получить книгу по ID.
    * `GET /item/title?title={title}` - Получить книгу по точному названию.
    * `POST /add?book_id={uuid}` - Добавить книгу в библиотеку текущего пользователя (требуется сессия).
    * `DELETE /delete?book_id={uuid}` - Удалить книгу из библиотеки текущего пользователя (требуется сессия).
* **Личная библиотека (`/my-catalog`)**
    * `GET /getAll?user_id={uuid}` - Получить все книги из библиотеки указанного пользователя (требуется сессия).

## Тестирование

Запустите тесты с помощью Gradle:

```bash
./gradlew test